{
  "scanId": "1755482304878",
  "timestamp": "2025-08-17T00:00:00.000Z",
  "ksiId": "KSI-IAM-01",
  "scanType": "automated",
  "status": "completed",
  "results": {
    "summary": {
      "totalChecks": 7,
      "passed": 3,
      "failed": 4,
      "warnings": 0
    },
    "mfaVerificationMethods": {
      "azureAd": [
        "Get-MsolUser | Where-Object {$_.StrongAuthenticationMethods -eq $null}",
        "az ad user list --query '[].{UserPrincipalName:userPrincipalName,MfaState:strongAuthenticationMethods[0].isDefault}'",
        "Azure Portal: Azure AD > Users > Multi-Factor Authentication",
        "Microsoft Graph API: /users/{id}/authentication/methods"
      ],
      "conditionalAccess": [
        "Get-AzureADMSConditionalAccessPolicy | Where-Object {$_.GrantControls.RequireMfa -eq $true}",
        "az rest --method get --url 'https://graph.microsoft.com/v1.0/identity/conditionalAccess/policies'",
        "Azure Portal: Azure AD > Conditional Access > Policies",
        "PowerShell: Get-AzureADMSConditionalAccessPolicy"
      ],
      "signInLogs": [
        "Azure Portal: Azure AD > Sign-ins > Filter by MFA requirement",
        "Log Analytics: SigninLogs | where AuthenticationRequirement == 'multiFactorAuthentication'",
        "Microsoft Graph API: /auditLogs/signIns",
        "Azure AD PowerShell: Get-AzureADAuditSignInLogs"
      ],
      "pim": [
        "Azure Portal: Azure AD > Privileged Identity Management > Roles > Settings",
        "PowerShell: Get-AzureADMSPrivilegedRoleSetting",
        "Microsoft Graph API: /privilegedAccess/azureResources/roleSettings",
        "Azure CLI: az rest --method get --url 'https://graph.microsoft.com/beta/privilegedAccess/azureResources/roleSettings'"
      ]
    },
    "mfaBestPractices": {
      "policyConfiguration": [
        "Implement global MFA requirement through Conditional Access",
        "Require MFA for all privileged operations and role activations",
        "Block legacy authentication protocols that bypass MFA",
        "Enforce MFA for Azure management operations"
      ],
      "methodSecurity": [
        "Promote Microsoft Authenticator app over SMS/voice",
        "Deploy FIDO2 security keys for high-risk users",
        "Implement Windows Hello for Business",
        "Disable insecure MFA methods (SMS where possible)"
      ],
      "userExperience": [
        "Configure MFA registration during first sign-in",
        "Provide multiple MFA method options",
        "Implement remember MFA for trusted devices",
        "Create user training and support resources"
      ],
      "monitoring": [
        "Monitor MFA registration and usage patterns",
        "Alert on MFA bypass attempts and failures",
        "Regular review of MFA exemptions and exceptions",
        "Implement risk-based MFA policies"
      ]
    },
    "complianceFrameworks": {
      "fedramp": {
        "IA-2": "Identification and Authentication (Organizational Users)",
        "IA-2(1)": "Network Access to Privileged Accounts",
        "IA-2(2)": "Network Access to Non-Privileged Accounts",
        "IA-2(11)": "Remote Access - Separate Device"
      },
      "nist80053": {
        "IA-2": "Identification and Authentication (Organizational Users)",
        "IA-2(1)": "Multifactor Authentication to Privileged Accounts",
        "IA-2(2)": "Multifactor Authentication to Non-Privileged Accounts",
        "IA-5": "Authenticator Management"
      },
      "iso27001": {
        "A.9.4.2": "Secure log-on procedures",
        "A.9.4.3": "Password management system",
        "A.13.1.1": "Network controls"
      }
    },
    "checks": [
      {
        "checkId": "IAM-01-001",
        "name": "Azure AD Conditional Access MFA Policies",
        "status": "PASS",
        "severity": "CRITICAL",
        "description": "All users should have MFA enforced through Conditional Access policies",
        "findings": {
          "conditionalAccessPolicies": {
            "totalPolicies": 8,
            "mfaPolicies": 5,
            "globalMfaPolicy": {
              "name": "Global MFA Requirement",
              "state": "enabled",
              "conditions": {
                "users": {
                  "includeUsers": "All",
                  "excludeUsers": [
                    "Emergency Access Account 1",
                    "Emergency Access Account 2"
                  ],
                  "includeGroups": [],
                  "excludeGroups": [
                    "Service Accounts"
                  ]
                },
                "applications": {
                  "includeApplications": "All",
                  "excludeApplications": [
                    "Azure Windows VM Sign-In"
                  ]
                },
                "locations": {
                  "includeLocations": "Any",
                  "excludeLocations": [
                    "Trusted Corporate Network"
                  ]
                }
              },
              "grantControls": {
                "requireMfa": true,
                "requireCompliantDevice": true,
                "requireDomainJoinedDevice": false,
                "requireApprovedApp": false,
                "sessionControls": "Sign-in frequency: 8 hours"
              }
            },
            "privilegedUserPolicy": {
              "name": "Privileged Users MFA",
              "state": "enabled",
              "targetUsers": "Global Admins, Privileged Role Admins",
              "controls": "MFA + Compliant Device + Sign-in frequency: 4 hours"
            }
          },
          "mfaRegistrationStatus": {
            "totalUsers": 247,
            "mfaRegisteredUsers": 245,
            "mfaCapableUsers": 245,
            "registrationRate": "99.2%",
            "unregisteredUsers": 2,
            "exemptUsers": 4
          },
          "mfaMethodDistribution": {
            "microsoftAuthenticator": 198,
            "phoneCall": 23,
            "smsText": 15,
            "hardwareTokens": 34,
            "softwareTokens": 67,
            "windowsHello": 156,
            "fido2SecurityKeys": 12
          },
          "complianceMonitoring": {
            "mfaSignInReporting": true,
            "failedMfaAttempts": {
              "last30Days": 45,
              "alertThreshold": 100,
              "alertingEnabled": true
            },
            "bypassed": {
              "last30Days": 3,
              "validReasons": 3,
              "alertingEnabled": true
            }
          }
        },
        "testResults": [
          {
            "test": "MFA policy enforcement verification",
            "result": "ENFORCED",
            "details": "Global MFA policy active for all users except emergency accounts"
          },
          {
            "test": "User registration status check",
            "result": "COMPLIANT",
            "details": "99.2% of users have MFA registered"
          },
          {
            "test": "MFA method diversity validation",
            "result": "DIVERSE",
            "details": "Multiple MFA methods available and distributed"
          }
        ],
        "remediation": "MFA properly enforced through Conditional Access with excellent compliance",
        "checkType": "mfaEnforcemen"
      },
      {
        "checkId": "IAM-01-002",
        "name": "Privileged Identity Management MFA Requirements",
        "status": "PASS",
        "severity": "CRITICAL",
        "description": "PIM role activations should require MFA verification",
        "findings": {
          "pimConfiguration": {
            "mfaRequirement": {
              "activationMfaRequired": true,
              "assignmentMfaRequired": true,
              "reAuthenticationRequired": true,
              "reAuthenticationInterval": "PT8H"
            },
            "roleSettings": [
              {
                "role": "Global Administrator",
                "activationMfa": true,
                "approvalRequired": true,
                "justificationRequired": true,
                "maxActivationDuration": "PT4H"
              },
              {
                "role": "Security Administrator",
                "activationMfa": true,
                "approvalRequired": true,
                "justificationRequired": true,
                "maxActivationDuration": "PT8H"
              },
              {
                "role": "Subscription Owner",
                "activationMfa": true,
                "approvalRequired": false,
                "justificationRequired": true,
                "maxActivationDuration": "PT8H"
              }
            ]
          },
          "activationMonitoring": {
            "totalActivations": 156,
            "mfaCompliantActivations": 156,
            "mfaComplianceRate": "100%",
            "failedMfaActivations": 4,
            "averageActivationTime": "PT2M30S"
          },
          "auditingCapabilities": {
            "activationLogging": true,
            "mfaEventLogging": true,
            "alertingRules": [
              {
                "trigger": "Failed MFA during activation",
                "severity": "High",
                "recipients": [
                  "security-team@company.com"
                ]
              },
              {
                "trigger": "Multiple failed activation attempts",
                "severity": "Critical",
                "recipients": [
                  "soc-team@company.com"
                ]
              }
            ]
          }
        },
        "testResults": [
          {
            "test": "PIM MFA enforcement check",
            "result": "ENFORCED",
            "details": "MFA required for all privileged role activations"
          },
          {
            "test": "Activation compliance validation",
            "result": "COMPLIANT",
            "details": "100% of activations completed MFA successfully"
          },
          {
            "test": "Monitoring and alerting verification",
            "result": "ACTIVE",
            "details": "Comprehensive monitoring and alerting configured"
          }
        ],
        "remediation": "PIM MFA requirements properly configured and monitored",
        "checkType": "mfaEnforcemen"
      },
      {
        "checkId": "IAM-01-003",
        "name": "Azure Resource Manager MFA Protection",
        "status": "PASS",
        "severity": "HIGH",
        "description": "Azure management operations should require MFA verification",
        "findings": {
          "azureManagementProtection": {
            "policyName": "Azure Management MFA",
            "state": "enabled",
            "targetApplications": [
              "Microsoft Azure Management",
              "Azure Resource Manager",
              "Azure Portal",
              "Azure PowerShell",
              "Azure CLI"
            ],
            "controls": {
              "requireMfa": true,
              "requireCompliantDevice": true,
              "sessionControls": {
                "signInFrequency": "PT4H",
                "persistentBrowser": "never"
              }
            }
          },
          "managementActivityMonitoring": {
            "protectedOperations": [
              "Resource creation/deletion",
              "Policy assignments",
              "Role assignments",
              "Security configuration changes",
              "Key Vault operations"
            ],
            "mfaCompliance": {
              "last30Days": {
                "totalOperations": 1247,
                "mfaProtectedOperations": 1247,
                "complianceRate": "100%"
              }
            }
          },
          "emergencyAccess": {
            "breakGlassAccounts": 2,
            "mfaExemption": true,
            "monitoringEnabled": true,
            "lastUsed": "Never",
            "reviewFrequency": "Monthly"
          }
        },
        "testResults": [
          {
            "test": "Azure management MFA policy check",
            "result": "ENFORCED",
            "details": "MFA required for all Azure management operations"
          },
          {
            "test": "Management operation compliance",
            "result": "COMPLIANT",
            "details": "100% of management operations MFA-protected"
          },
          {
            "test": "Emergency access monitoring",
            "result": "MONITORED",
            "details": "Break-glass accounts properly monitored"
          }
        ],
        "remediation": "Azure management operations properly protected with MFA",
        "checkType": "mfaEnforcemen"
      },
      {
        "checkId": "IAM-01-004",
        "name": "Legacy Authentication Protocol Gaps",
        "status": "FAIL",
        "severity": "CRITICAL",
        "description": "Legacy authentication protocols bypass MFA requirements",
        "findings": {
          "legacyAuthenticationIssues": {
            "legacyProtocolsEnabled": true,
            "blockedProtocols": [
              "Basic Auth for Exchange ActiveSync"
            ],
            "allowedProtocols": [
              "IMAP",
              "POP3",
              "SMTP AUTH",
              "Exchange Web Services (EWS)",
              "Exchange ActiveSync (partial)"
            ],
            "mfaBypassRisk": "HIGH"
          },
          "authenticationAnalysis": {
            "last30Days": {
              "totalSignIns": 45678,
              "legacyAuthSignIns": 2847,
              "legacyAuthPercentage": "6.2%",
              "mfaBypassedSignIns": 2847,
              "affectedUsers": 34,
              "riskScore": "HIGH"
            },
            "protocolBreakdown": [
              {
                "protocol": "IMAP",
                "signIns": 1234,
                "users": 18,
                "mfaBypassed": true
              },
              {
                "protocol": "POP3",
                "signIns": 456,
                "users": 8,
                "mfaBypassed": true
              },
              {
                "protocol": "SMTP AUTH",
                "signIns": 1157,
                "users": 23,
                "mfaBypassed": true
              }
            ]
          },
          "businessImpact": {
            "affectedApplications": [
              "Outlook 2016 (older versions)",
              "Third-party email clients",
              "Mobile email apps (legacy configuration)",
              "Automated email systems"
            ],
            "migrationComplexity": "Medium",
            "userTrainingRequired": true
          },
          "securityGaps": {
            "passwordSprayRisk": "HIGH",
            "bruteForceRisk": "HIGH",
            "credentialStuffingRisk": "HIGH",
            "complianceRisk": "CRITICAL"
          }
        },
        "testResults": [
          {
            "test": "Legacy authentication protocol check",
            "result": "ENABLED",
            "details": "Multiple legacy protocols still permitted"
          },
          {
            "test": "MFA bypass assessment",
            "result": "BYPASSED",
            "details": "6.2% of sign-ins bypass MFA through legacy protocols"
          },
          {
            "test": "Security risk evaluation",
            "result": "HIGH_RISK",
            "details": "Significant exposure to password-based attacks"
          }
        ],
        "complianceGaps": [
          {
            "requirement": "FedRAMP IA-2 (Identification and Authentication)",
            "status": "NON_COMPLIANT",
            "issue": "Legacy protocols bypass MFA requirements"
          }
        ],
        "remediation": "CRITICAL: 1) Disable all legacy authentication protocols, 2) Migrate applications to modern authentication, 3) Implement app passwords where absolutely necessary, 4) Monitor and alert on any legacy authentication attempts, 5) Conduct user training on modern email client configuration",
        "checkType": "mfaEnforcemen"
      },
      {
        "checkId": "IAM-01-005",
        "name": "Service Account MFA Exemption Issues",
        "status": "FAIL",
        "severity": "HIGH",
        "description": "Service accounts lack proper MFA alternatives and monitoring",
        "findings": {
          "serviceAccountInventory": {
            "totalServiceAccounts": 67,
            "mfaExempted": 67,
            "managedIdentityMigration": 23,
            "remainingLegacyAccounts": 44,
            "exemptionJustifications": [
              {
                "account": "svc-backup-automation",
                "justification": "Automated backup processes",
                "alternativeSecurity": "Certificate-based authentication",
                "lastReview": "2025-06-15T00:00:00.000Z"
              },
              {
                "account": "svc-monitoring-agent",
                "justification": "24/7 monitoring service",
                "alternativeSecurity": "IP restriction + strong password",
                "lastReview": "2025-05-20T00:00:00.000Z"
              }
            ]
          },
          "securityControls": {
            "alternativeAuthentication": {
              "certificateAuth": 15,
              "managedIdentity": 23,
              "restrictedNetworks": 29,
              "noAlternatives": 18
            },
            "accessRestrictions": {
              "ipRestrictions": 29,
              "deviceRestrictions": 12,
              "timeRestrictions": 8,
              "applicationRestrictions": 34
            },
            "monitoringControls": {
              "signInMonitoring": true,
              "unusualActivityDetection": false,
              "privilegedOperationAlerting": true,
              "regularAccessReviews": false
            }
          },
          "complianceGaps": {
            "unprotectedAccounts": 18,
            "outdatedReviews": 23,
            "missingDocumentation": 12,
            "excessivePermissions": 8
          },
          "migrationPlan": {
            "managedIdentityTargets": 25,
            "certificateAuthTargets": 15,
            "applicationModificationRequired": 31,
            "estimatedCompletionTime": "P180D"
          }
        },
        "testResults": [
          {
            "test": "Service account MFA exemption review",
            "result": "EXCESSIVE",
            "details": "67 service accounts exempt from MFA requirements"
          },
          {
            "test": "Alternative security controls check",
            "result": "INCOMPLETE",
            "details": "18 accounts lack adequate alternative security controls"
          },
          {
            "test": "Monitoring and review validation",
            "result": "INADEQUATE",
            "details": "Limited monitoring and irregular access reviews"
          }
        ],
        "remediation": "HIGH PRIORITY: 1) Migrate to managed identities where possible, 2) Implement certificate-based authentication for remaining service accounts, 3) Apply additional security controls (IP restrictions, monitoring), 4) Establish regular access reviews, 5) Document and justify all MFA exemptions, 6) Implement enhanced monitoring for exempt accounts",
        "checkType": "mfaEnforcemen"
      },
      {
        "checkId": "IAM-01-006",
        "name": "Guest User MFA Enforcement Gaps",
        "status": "FAIL",
        "severity": "HIGH",
        "description": "Guest users have inconsistent MFA enforcement and monitoring",
        "findings": {
          "guestUserInventory": {
            "totalGuestUsers": 89,
            "mfaRegisteredGuests": 34,
            "mfaExemptedGuests": 55,
            "activeGuests": 67,
            "inactiveGuests": 22,
            "guestUserCategories": [
              {
                "category": "External Partners",
                "count": 23,
                "mfaEnforced": true,
                "accessLevel": "Limited"
              },
              {
                "category": "Contractors",
                "count": 34,
                "mfaEnforced": false,
                "accessLevel": "Extended",
                "issue": "MFA not enforced for contractor access"
              },
              {
                "category": "Temporary Consultants",
                "count": 32,
                "mfaEnforced": false,
                "accessLevel": "Variable",
                "issue": "No standardized MFA policy"
              }
            ]
          },
          "accessControlIssues": {
            "inconsistentPolicies": {
              "issue": "Different MFA requirements based on invitation method",
              "impact": "Security gaps for high-risk guest access"
            },
            "invitationProcess": {
              "securityReview": false,
              "mfaRequirement": "Optional",
              "accessLevelValidation": false,
              "expirationDates": "Not enforced"
            },
            "privilegedGuestAccess": {
              "guestsWithPrivilegedRoles": 8,
              "mfaCompliance": "37.5%",
              "riskLevel": "HIGH"
            }
          },
          "monitoringDeficiencies": {
            "guestActivityTracking": {
              "signInMonitoring": "Basic",
              "riskDetection": false,
              "privilegedOperationAlerting": false,
              "accessReviews": "Manual, irregular"
            },
            "complianceReporting": {
              "guestMfaCompliance": "Not tracked",
              "accessCertification": "Annual only",
              "privilegedGuestReporting": "Manual"
            }
          }
        },
        "testResults": [
          {
            "test": "Guest user MFA compliance check",
            "result": "NON_COMPLIANT",
            "details": "Only 38% of guest users have MFA registered"
          },
          {
            "test": "Guest access policy consistency",
            "result": "INCONSISTENT",
            "details": "Different MFA policies for different guest categories"
          },
          {
            "test": "Privileged guest access validation",
            "result": "HIGH_RISK",
            "details": "8 privileged guests with only 37.5% MFA compliance"
          }
        ],
        "remediation": "HIGH PRIORITY: 1) Enforce MFA for all guest users through Conditional Access, 2) Standardize guest invitation and onboarding process, 3) Implement regular guest access reviews, 4) Remove privileged access for non-compliant guests, 5) Establish guest user lifecycle management, 6) Implement enhanced monitoring for guest activities",
        "checkType": "mfaEnforcemen"
      },
      {
        "checkId": "IAM-01-007",
        "name": "Mobile Device MFA Bypass Vulnerabilities",
        "status": "FAIL",
        "severity": "MEDIUM",
        "description": "Mobile applications and devices show MFA bypass possibilities",
        "findings": {
          "mobileDeviceCompliance": {
            "totalMobileDevices": 156,
            "managedDevices": 98,
            "compliantDevices": 87,
            "mfaCapableDevices": 134,
            "deviceCategories": [
              {
                "platform": "iOS",
                "count": 67,
                "managed": 52,
                "compliant": 49,
                "mfaSupport": "Full"
              },
              {
                "platform": "Android",
                "count": 89,
                "managed": 46,
                "compliant": 38,
                "mfaSupport": "Partial"
              }
            ]
          },
          "applicationMfaBypass": {
            "mobileApplications": [
              {
                "appName": "Outlook Mobile",
                "mfaEnforced": false,
                "authMethod": "App passwords",
                "riskLevel": "MEDIUM",
                "issue": "App passwords bypass MFA"
              },
              {
                "appName": "Custom Business App",
                "mfaEnforced": false,
                "authMethod": "Basic authentication",
                "riskLevel": "HIGH",
                "issue": "No MFA integration"
              }
            ],
            "byodChallenges": {
              "personalDevices": 58,
              "managementLimitations": true,
              "mfaEnforcement": "Limited",
              "complianceGaps": "Significant"
            }
          },
          "deviceManagementGaps": {
            "unmanagedDevices": 58,
            "nonCompliantDevices": 69,
            "mfaBypassRisk": [
              "Saved passwords on unmanaged devices",
              "Biometric authentication without MFA",
              "App-specific passwords",
              "Certificate-based authentication without MFA"
            ]
          }
        },
        "testResults": [
          {
            "test": "Mobile device MFA compliance check",
            "result": "PARTIAL",
            "details": "86% of devices MFA-capable, but enforcement gaps exist"
          },
          {
            "test": "Mobile application MFA verification",
            "result": "BYPASSED",
            "details": "Some mobile apps use authentication methods that bypass MFA"
          },
          {
            "test": "BYOD security assessment",
            "result": "INSUFFICIENT",
            "details": "Limited control over personal device MFA enforcement"
          }
        ],
        "remediation": "MEDIUM PRIORITY: 1) Enforce MFA for all mobile applications, 2) Eliminate app password usage, 3) Implement mobile application management (MAM), 4) Establish BYOD security policies, 5) Deploy mobile device compliance policies, 6) Implement conditional access for mobile devices",
        "checkType": "mfaEnforcemen"
      }
    ]
  }
}